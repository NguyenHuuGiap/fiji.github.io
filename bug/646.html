<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 646 &ndash; Fiji fails launching after both ./Build.sh and update</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="">

  


  
    
      

      
      



    
    <link href="../css/global.css"
          rel="alternate stylesheet" 
          title="Classic"><link href="../css/global.css" rel="stylesheet"
        type="text/css" ><link href="../css/bug.css" rel="stylesheet"
        type="text/css" >

    <link href="../css/dusk.css" rel="stylesheet"
        type="text/css" title="Dusk">

    

    

    


    


    

    
    
    
  </head>



  <body onload=""
        class=" bz_bug bz_status_RESOLVED bz_product_Fiji bz_component_Other bz_bug_646 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;646</p>
    </td>

    <td id="subtitle">
      <p class="subheader">Fiji fails launching after both ./Build.sh and update</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2013-08-03 06:24:24 CDT</p>
    </td>
</tr>
</table>


</div> 

<div id="notice">
  <table>
    <tr>
      <td style="font-size: 72px; color: firebrick; padding: 0 10px 0 10px">&#9888;</td>
      <td>
        <p style="margin: 0.4em">
        NOTICE! This is a static HTML version of a legacy Fiji BugZilla bug.
        </p>
        <p style="margin: 0.4em">
        The Fiji project now
        <a href="https://imagej.net/Issues">uses GitHub Issues</a> for issue tracking.
        </p>
        <p style="margin: 0.4em">
        Please
        <a href="https://github.com/fiji/fiji/issues/new">file all new issues</a>
        there.
        </p>
      </td>
    </tr>
  </table>
</div>

<div id="bugzilla-body">


<div class="bz_alias_short_desc_container edit_form">
     <a href="646.html"><b>Bug&nbsp;646</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Fiji fails launching after both ./Build.sh and update</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
  >Summary:</a>
</label>
</th>
          <td>Fiji fails launching after both ./Build.sh and update
          </td>
        </tr>
      </table>
    </div>
  </div>
  
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a>Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Fiji</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Other</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">PC
       Linux
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a><u>I</u>mportance</a></label>:
      </th>
      <td>P5
       blocker
      </td>
    </tr>            
          
          <tr>
      <th class="field_label">
        <a>Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">ImageJ Bugs Mailing List</span>
</span>
      </td>
    </tr>

    
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2013-08-01 04:56 CDT by <span class="vcard"><span class="fn">Stephan Saalfeld</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2013-08-03 06:24 CDT 
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>1 
          user
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="johannes.schindelin">johannes.schindelin</option>
            </select>
        </div>
          
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    


<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_image_png">
        <td valign="top">
            <a href="../attach/114/fiji-after-mvn-2013-08-02.png"
               title="View the content of the attachment">
          <b>Fiji message after mvn build</b></a>

          <span class="bz_attach_extra_info">
              (11.41 KB,
                image/png)

            <br>
            <a href="#attach_114"
               title="Go to the comment associated with the attachment">2013-08-02 04:15 CDT</a>,

            <span class="vcard"><span class="fn">Stephan Saalfeld</span>
</span>
          </span>
        </td>


        <td valign="top">
        </td>
      </tr>

  </table>
<br>

  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments">






<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stephan Saalfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-01 04:56:54 CDT
        </span>
      </div>



<pre class="bz_comment_text" >I pulled the current fiji master and called

./Build.sh

Not much happened but the generated launchers cannot start Fiji, exception message later.  If I call mvn, it generates a Fiji that is running.  Updating this Fiji with its updater again breaks it to not running.  Excetion printed to the terminal:

saalfeld&#64;saalfeld-thinkpad:~/workspace/fiji-clean (master)$ ./ImageJ-linux64 
Exception in thread &quot;main&quot; java.lang.ExceptionInInitializerError
	at fiji.IJ1Patcher.run(IJ1Patcher.java:43)
	at imagej.ClassLauncher.patchIJ1(ClassLauncher.java:170)
	at imagej.ClassLauncher.run(ClassLauncher.java:129)
	at imagej.ClassLauncher.main(ClassLauncher.java:72)
Caused by: java.lang.IllegalArgumentException: Cannot modify method: void init(java.lang.String path)
	at imagej.legacy.CodeHacker.insertAtTopOfMethod(CodeHacker.java:209)
	at imagej.legacy.LegacyExtensions.addExtraPlugins(LegacyExtensions.java:632)
	at imagej.legacy.LegacyExtensions.injectHooks(LegacyExtensions.java:415)
	at imagej.legacy.LegacyInjector.injectHooks(LegacyInjector.java:153)
	at imagej.legacy.LegacyInjector.injectHooks(LegacyInjector.java:57)
	at imagej.legacy.DefaultLegacyService.&lt;clinit&gt;(DefaultLegacyService.java:111)
	... 4 more
Caused by: javassist.CannotCompileException: [source error] addJAR(java.io.File) not found in ij.io.PluginClassLoader
	at javassist.CtBehavior.insertBefore(CtBehavior.java:741)
	at javassist.CtBehavior.insertBefore(CtBehavior.java:701)
	at imagej.legacy.CodeHacker.insertAtTopOfMethod(CodeHacker.java:205)
	... 9 more
Caused by: compile error: addJAR(java.io.File) not found in ij.io.PluginClassLoader
	at javassist.compiler.TypeChecker.atMethodCallCore(TypeChecker.java:723)
	at javassist.compiler.TypeChecker.atCallExpr(TypeChecker.java:688)
	at javassist.compiler.JvstTypeChecker.atCallExpr(JvstTypeChecker.java:157)
	at javassist.compiler.ast.CallExpr.accept(CallExpr.java:46)
	at javassist.compiler.CodeGen.doTypeCheck(CodeGen.java:242)
	at javassist.compiler.CodeGen.atStmnt(CodeGen.java:330)
	at javassist.compiler.ast.Stmnt.accept(Stmnt.java:50)
	at javassist.compiler.CodeGen.atStmnt(CodeGen.java:351)
	at javassist.compiler.ast.Stmnt.accept(Stmnt.java:50)
	at javassist.compiler.CodeGen.atForStmnt(CodeGen.java:480)
	at javassist.compiler.CodeGen.atStmnt(CodeGen.java:359)
	at javassist.compiler.ast.Stmnt.accept(Stmnt.java:50)
	at javassist.compiler.Javac.compileStmnt(Javac.java:569)
	at javassist.CtBehavior.insertBefore(CtBehavior.java:721)
	... 11 more</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stephan Saalfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-02 04:06:04 CDT
        </span>
      </div>



<pre class="bz_comment_text" >I have just tested from a fresh clone from github and the result is the same.  The platform is a different PC, though with the same operating system, Ubuntu 12.04  The Fiji-Logo is briefly shown and then it exits with the Exception shown in the original report.

Any help highly appreciated.</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stephan Saalfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-02 04:15:40 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="../attach/114/fiji-after-mvn-2013-08-02.png" name="attach_114" title="Fiji message after mvn build">attachment 114</a></span>
Fiji message after mvn build

After building with mvn, the executable works but the attached message shows up.  If I manually delete the redundant files, an anew mvn build recreates them and the message shows again.  I assume that ./Build.sh would somehow prevent this but, well, it doesn't work.

Again, thanks for any help.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stephan Saalfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-02 04:20:27 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Running the updater first identifies several obsolete versions of particular jars.  I decided to delete them all.  After that, the updater stops working with the following Exception:

[INFO] Trying to install and execute the new updater
Exception in thread &quot;Thread-6&quot; net.java.sezpoz.IndexError: java.util.zip.ZipException: error in opening zip file
	at net.java.sezpoz.Index$LazyIndexIterator.peek(Index.java:180)
	at net.java.sezpoz.Index$LazyIndexIterator.hasNext(Index.java:185)
	at org.scijava.plugin.DefaultPluginFinder.findPlugins(DefaultPluginFinder.java:83)
	at org.scijava.plugin.DefaultPluginFinder.findPlugins(DefaultPluginFinder.java:53)
	at org.scijava.plugin.PluginIndex.discover(PluginIndex.java:103)
	at org.scijava.Context.&lt;init&gt;(Context.java:158)
	at org.scijava.Context.&lt;init&gt;(Context.java:120)
	at org.scijava.Context.&lt;init&gt;(Context.java:108)
	at imagej.updater.gui.UpdaterFrame.getUploaderService(UpdaterFrame.java:538)
	at imagej.updater.gui.ImageJUpdater.run(ImageJUpdater.java:208)
	at java.lang.Thread.run(Thread.java:662)
Caused by: java.util.zip.ZipException: error in opening zip file
	at java.util.zip.ZipFile.open(Native Method)
	at java.util.zip.ZipFile.&lt;init&gt;(ZipFile.java:127)
	at java.util.jar.JarFile.&lt;init&gt;(JarFile.java:135)
	at java.util.jar.JarFile.&lt;init&gt;(JarFile.java:72)
	at sun.net.www.protocol.jar.URLJarFile.&lt;init&gt;(URLJarFile.java:72)
	at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:48)
	at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:55)
	at sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:104)
	at sun.net.www.protocol.jar.JarURLConnection.getInputStream(JarURLConnection.java:132)
	at java.net.URL.openStream(URL.java:1010)
	at net.java.sezpoz.Index$LazyIndexIterator.peek(Index.java:151)
	... 10 more</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Schindelin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-02 11:47:16 CDT
        </span>
      </div>



<pre class="bz_comment_text" >The issue is that the pom.xml information in fiji.git has slightly contradicting transitive information: it wants to link to ImageJ 2 beta 7.1 which wants to link to ImageJ 1.47v, but fiji.git also wants to link to ImageJ 1.48a which introduced the breakage you described.

So it is better to think of the information in the Maven projects as compile-time information, but of course you should run the updater to work around this issue (I thought this self-evident, so I took care of more pressing issues for less clueful persons).</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stephan Saalfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-02 13:01:13 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Thanks for the comment Johannes.  The problem is that I cannot run the updater because it breaks Fiji built by mvn as I described.  Fiji fails to start after update showing the posted exception.  I also cannot build Fiji using Build.sh because that, from the beginning, generates a Fiji that fails to start with that exact exception.  I admit that I am completely clueless what to do with it.

What I am experiencing is that I cannot use the updater of a Fiji that I built myself.  Sorry if I wasn't clear about that.</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Schindelin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-02 15:05:23 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Sorry, I assumed that you are familiar with the inner workings of Maven (in fact, our switch to Maven was based in large parts on your complaints about reproducible builds, the bloat of the precompiled/ directory, the fact that we used a non-standard build system you were unable to help me fix bugs with, etc).

The issues should have been resolved with the recent bump of the pom-scijava version used in fiji.git, as we now have a release coupling with the freshly-released ImageJ 2.0.0 beta 7.2 which I nicknamed &quot;for Stephan, with love from Johannes&quot;.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stephan Saalfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-03 06:24:24 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Thanks for fixing this blocker and also for the love.

Beyond, I keep failing to see how I could have been helpful in resolving this issue economically except by reporting it.  It is a far way to conclude pom.xml inconcistencies when both mvn and ./Build.sh report success, and the result is an updater that breaks a running Fiji or a not running Fiji to begin with.  Apparently, I do not know about the inner workings of [mini]maven and the release cycles of ImageJ2 and scijava are notoriously external to my range of influence.

Thinking economically, I assume that it took me longer to write this bug report than it took you, the supposed designer of the bug, to find and fix it.  So I understand that we've both done our work well on this issue.  Thanks again for the fix and your great work in general.

Best,
Stephan</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        



</div>

</body>
</html>
