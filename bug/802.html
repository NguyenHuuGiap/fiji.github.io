<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 802 &ndash; Voxel depth info lost when opening hyperstack with SCIFIO (plus brightness/contrast issue)</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="">

  


  
    
      

      
      



    
    <link href="../css/global.css"
          rel="alternate stylesheet" 
          title="Classic"><link href="../css/global.css" rel="stylesheet"
        type="text/css" ><link href="../css/bug.css" rel="stylesheet"
        type="text/css" >

    <link href="../css/dusk.css" rel="stylesheet"
        type="text/css" title="Dusk">

    

    

    


    


    

    
    
    
  </head>



  <body onload=""
        class=" bz_bug bz_status_RESOLVED bz_product_ImageJ bz_component_SCIFIO bz_bug_802 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;802</p>
    </td>

    <td id="subtitle">
      <p class="subheader">Voxel depth info lost when opening hyperstack with SCIFIO (plus brightness/contrast issue)</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2015-04-06 15:49:25 CDT</p>
    </td>
</tr>
</table>


</div> 

<div id="notice">
  <table>
    <tr>
      <td style="font-size: 72px; color: firebrick; padding: 0 10px 0 10px">&#9888;</td>
      <td>
        <p style="margin: 0.4em">
        NOTICE! This is a static HTML version of a legacy Fiji BugZilla bug.
        </p>
        <p style="margin: 0.4em">
        The Fiji project now
        <a href="https://imagej.net/Issues">uses GitHub Issues</a> for issue tracking.
        </p>
        <p style="margin: 0.4em">
        Please
        <a href="https://github.com/fiji/fiji/issues/new">file all new issues</a>
        there.
        </p>
      </td>
    </tr>
  </table>
</div>

<div id="bugzilla-body">


<div class="bz_alias_short_desc_container edit_form">
     <a href="802.html"><b>Bug&nbsp;802</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Voxel depth info lost when opening hyperstack with SCIFIO (plus brightness/contrast issue)</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
  >Summary:</a>
</label>
</th>
          <td><span title="Voxel depth info lost when opening hyperstack with SCIFIO (plus brightness/contrast issue)">Voxel depth info lost when opening hyperstack with SCIFIO (plus brightness/co...
        </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a>Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >ImageJ</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >SCIFIO</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">PC
       Windows
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a><u>I</u>mportance</a></label>:
      </th>
      <td>P4
       normal
      </td>
    </tr>            
          
          <tr>
      <th class="field_label">
        <a>Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">ImageJ Bugs Mailing List</span>
</span>
      </td>
    </tr>

    
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2014-06-19 16:28 CDT by <span class="vcard"><span class="fn">Keith Siew</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2015-04-06 15:49 CDT 
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>3 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="ctrueden">ctrueden</option>
                <option value="imagej-bugs">imagej-bugs</option>
                <option value="keith.siew">keith.siew</option>
            </select>
        </div>
          
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    



  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments">






<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Keith Siew</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-06-19 16:28:32 CDT
        </span>
      </div>



<pre class="bz_comment_text" >When using drag and drop on a .TIFF hyperstack file with the SCIFIO active, the following two things occur:

1. The file opens with a new brightness and contrast setting that shows the image extremely saturated (i.e. it shrinks the histogram from 0-255 to 0-20). I have to manually reset the brightness and contrast to bring it back to the original. How do I disable this?

2. I noticed that when I go into image properties that the voxel depth is lost and reset to 1

Information about your version of Java:

  os.arch =&gt; amd64
  os.name =&gt; Windows NT (unknown)
  os.version =&gt; 6.2
  java.version =&gt; 1.6.0_24
  java.vendor =&gt; Sun Microsystems Inc.
  java.runtime.name =&gt; Java(TM) SE Runtime Environment
  java.runtime.version =&gt; 1.6.0_24-b07
  java.vm.name =&gt; Java HotSpot(TM) 64-Bit Server VM
  java.vm.version =&gt; 19.1-b02
  java.vm.vendor =&gt; Sun Microsystems Inc.
  java.vm.info =&gt; mixed mode
  java.awt.graphicsenv =&gt; sun.awt.Win32GraphicsEnvironment
  java.specification.name =&gt; Java Platform API Specification
  java.specification.version =&gt; 1.6
  sun.cpu.endian =&gt; little
  sun.desktop =&gt; windows
  file.separator =&gt; \

The up-to-date check says: REMIND_LATER

Information relevant to JAVA_HOME related problems:

  JAVA_HOME is set to: C:\Users\Keith\Desktop\Fiji.app/java/win64/jdk1.6.0_24//jre
  imagej.dir =&gt; C:\Users\Keith\Desktop\Fiji.app

Information about the version of each plugin:

Activated update sites:
ImageJ: <a href="http://update.imagej.net/">http://update.imagej.net/</a> (last check:20140619220447)
Fiji: <a href="http://fiji.sc/update/">http://fiji.sc/update/</a> (last check:20140618210039)</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-06-20 23:58:08 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Thanks for the bug report.

For issue 1: SCIFIO always autoscales, regardless of the input data type. This behavior differs from ImageJ 1.x, which does not initially autoscale 8-bit images. That said, SCIFIO should not be narrowing the display range beyond that of the input data itself -- so if you're seeing 0-20, is it true that 20 is the largest intensity value in your image? If not, that may be a bug.

For issue 2: I was able to reproduce the bug by opening MRI Stack, setting the unit to &quot;micron&quot; and voxel depth to &quot;5&quot;, saving as a TIFF, then reopening. The unit is preserved but voxel depth is lost. There _is_ code in SCIFIO to preserve it though, so chances are the bug will be something simple to fix.

In the meantime, you can work around both issues by disabling SCIFIO (Edit &gt; Options &gt; ImageJ2).</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-06-21 01:00:28 CDT
        </span>
      </div>



<pre class="bz_comment_text" >The calibration issue is fixed on the SCIFIO master branch now:
<a href="https://github.com/scifio/scifio/commit/8e439102b5f0c854afeb673a5a62cd9c6b2c880e">https://github.com/scifio/scifio/commit/8e439102b5f0c854afeb673a5a62cd9c6b2c880e</a>

Just needs a little more testing, release and upload. We'll do that on Monday.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-06-23 15:27:02 CDT
        </span>
      </div>



<pre class="bz_comment_text" >I uploaded a new SCIFIO which fixes issue (2).

Feel free to follow up on issue (1) if you like, if the autoscaling behavior is too annoying and/or unexpected.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Keith Siew</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-06-24 02:34:39 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Hi Curtis,

Thanks a million for resolving issue 2, I've just tested it on my stacks and works great.

Regarding issue 1, I've done a bit of checking in the stack to see what might be going on and it appears that it's autoscaling on only the first image in the hyperstack, which indeed does have a 0-20 8bit range. However there are values of 255 in later stack slices (in fact the majority) so the overall stack becomes complete saturated looking and unworkable with the autoscaling currently as it is.

Would it be useful for me to upload the image file I'm working with so you can replicate what I'm seeing and attempt to resolve the bug, so it autoscales based on the whole stack rather than the first slice alone.


Kind Regards,
Keith</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-06-24 08:09:51 CDT
        </span>
      </div>



<pre class="bz_comment_text" ><span class="quote">&gt; Would it be useful for me to upload the image file I'm working with so
&gt; you can replicate what I'm seeing and attempt to resolve the bug, so
&gt; it autoscales based on the whole stack rather than the first slice
&gt; alone.</span >

Thanks for the offer, but in this case we do not need additional sample images. The behavior you describe (autoscaling based on the first plane) is completely expected.

The problem is basically that we want to support really, really huge datasets in a scalable way. One of the coolest things about the new SCIFIO support is that it will transparently use a virtual stack -- i.e., not read in all the image planes in advance -- when the data is large, so that you can get started visualizing and analyzing the data sooner.

However, that approach comes with a price: we do not yet know all the pixel values, and hence do not know the global data min/max values at the time the first image plane is displayed.

So my question to you is: keeping in mind the above, how would you prefer it behave?

1) We can certainly read all the pixels in advance and then autoscale. But then you have to wait longer for the image to pop up, as with ImageJ 1.x. It would be the return of the loading progress bar.

2) We could show the first plane immediately, and keep loading planes in the background and adjust the autoscale later. But then your image would appear to &quot;dim&quot; over time as additional planes are read, which strikes me as scary and unintuitive.

3) We could provide an option. But our current approach is to make File&gt;Open display _no_ options (i.e., behave with only defaults), and for File&gt;Import&gt;Image... to have all the options if you need to tweak them. So even if we provide nice autoscaling options, we will still need to decide on a default.

4) We could keep the current behavior, and then you'll need to run Image&gt;Adjust&gt;Brightness/Contrast after the fact to adjust the display min/max as you desire.

5) We could special case the behavior for unsigned 8-bit integer data to always use 0-255, which is IIRC what ImageJ 1.x does. But that would not solve the problem for other data types such as 12-bit or 16-bit. Another downside of that approach is that for people whose data really does have a small dark range (e.g., 0-20 through the entire dataset), the image will appear black. That situation is actually very common when in low signal scenarios, so lots of new users have historically complained about their data being &quot;missing&quot; when really it's just a display scaling issue. It is even the first question in the ImageJ FAQ: <a href="http://wiki.imagej.net/FAQ#The_image_I_loaded_is_displayed_all_black.21_But_it_is_not_black.21">http://wiki.imagej.net/FAQ#The_image_I_loaded_is_displayed_all_black.21_But_it_is_not_black.21</a>

6) Some other brilliant solution? :-)

So current thinking is that autoscaling based on the first plane (option 4 above) is the &quot;lesser of all evils&quot; here. But if you have any better ideas, they would be very welcome!</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        



</div>

</body>
</html>
