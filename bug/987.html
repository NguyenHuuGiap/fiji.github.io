<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 987 &ndash; saveAs(&quot;Results&quot;, &quot;...&quot;) does not work</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="">

  


  
    
      

      
      



    
    <link href="../css/global.css"
          rel="alternate stylesheet" 
          title="Classic"><link href="../css/global.css" rel="stylesheet"
        type="text/css" ><link href="../css/bug.css" rel="stylesheet"
        type="text/css" >

    <link href="../css/dusk.css" rel="stylesheet"
        type="text/css" title="Dusk">

    

    

    


    


    

    
    
    
  </head>



  <body onload=""
        class=" bz_bug bz_status_RESOLVED bz_product_Fiji bz_component_Plugins bz_bug_987 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;987</p>
    </td>

    <td id="subtitle">
      <p class="subheader">saveAs(&quot;Results&quot;, &quot;...&quot;) does not work</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2015-01-15 20:28:55 CST</p>
    </td>
</tr>
</table>


</div> 

<div id="notice">
  <table>
    <tr>
      <td style="font-size: 72px; color: firebrick; padding: 0 10px 0 10px">&#9888;</td>
      <td>
        <p style="margin: 0.4em">
        NOTICE! This is a static HTML version of a legacy Fiji BugZilla bug.
        </p>
        <p style="margin: 0.4em">
        The Fiji project now
        <a href="https://imagej.net/Issues">uses GitHub Issues</a> for issue tracking.
        </p>
        <p style="margin: 0.4em">
        Please
        <a href="https://github.com/fiji/fiji/issues/new">file all new issues</a>
        there.
        </p>
      </td>
    </tr>
  </table>
</div>

<div id="bugzilla-body">


<div class="bz_alias_short_desc_container edit_form">
     <a href="987.html"><b>Bug&nbsp;987</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">saveAs(&quot;Results&quot;, &quot;...&quot;) does not work</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
  >Summary:</a>
</label>
</th>
          <td>saveAs(&quot;Results&quot;, &quot;...&quot;) does not work
          </td>
        </tr>
      </table>
    </div>
  </div>
  
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a>Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Fiji</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Plugins</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">PC
       Windows
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a><u>I</u>mportance</a></label>:
      </th>
      <td>P4
       normal
      </td>
    </tr>            
          
          <tr>
      <th class="field_label">
        <a>Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">ImageJ Bugs Mailing List</span>
</span>
      </td>
    </tr>

    
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2015-01-13 15:25 CST by <span class="vcard">tokamoto
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2015-01-15 20:28 CST 
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>2 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="tokamoto">tokamoto</option>
                <option value="wsr">wsr</option>
            </select>
        </div>
          
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    



  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments">






<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">tokamoto
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-01-13 15:25:08 CST
        </span>
      </div>



<pre class="bz_comment_text" >I'm trying to save some results as a csv file in a macro.  When I run it using ImageJ 1.49m it works fine, using 1.49n no files are saved.

Here's a mini macro to help with my issue, including my initialization steps.

setBatchMode(true);
setOption(&quot;ShowRowNumbers&quot;, false);
requires(&quot;1.49m&quot;);
run(&quot;Set Measurements...&quot;, &quot;area mean standard min median redirect=None decimal=3&quot;);
run(&quot;Input/Output...&quot;, &quot;jpeg=85 gif=-1 file=.csv save_column&quot;);

run(&quot;Table...&quot;, &quot;name=Points width=400 height=200&quot;);
print(&quot;[Points]&quot;, &quot;Header1, Header2, Header3&quot;);
print(&quot;[Points]&quot;, &quot;Data1, Data2, Data3&quot;);
selectWindow(&quot;Points&quot;);
saveAs(&quot;Results&quot;, &quot;C:\\Users\\tokamoto\\Desktop\\Results_Points.csv&quot;);
run(&quot;Close&quot;);

My final Points table usually looks similar to the following...

Points
Filename, 1, 2, 3, 4, 5, 6
Filename, 1, 2, 3, 4, 5, 6

In my macro, I'm transferring results from the results table to the &quot;Points&quot; table, with each row containing a filename, then numbers all separated by commas.

The &quot;Points&quot; table is full when it is saved, but no file is created.  I've had to downgrade to 1.49m in the mean time.

Information about your version of Java:

  os.arch =&gt; amd64
  os.name =&gt; Windows 7
  os.version =&gt; 6.1
  java.version =&gt; 1.6.0_24
  java.vendor =&gt; New Oracle
  java.runtime.name =&gt; Java(TM) SE Runtime Environment
  java.runtime.version =&gt; 1.6.0_24-b07
  java.vm.name =&gt; Java HotSpot(TM) 64-Bit Server VM
  java.vm.version =&gt; 19.1-b02
  java.vm.vendor =&gt; Sun Microsystems Inc.
  java.vm.info =&gt; mixed mode
  java.awt.graphicsenv =&gt; sun.awt.Win32GraphicsEnvironment
  java.specification.name =&gt; Java Platform API Specification
  java.specification.version =&gt; 1.6
  sun.cpu.endian =&gt; little
  sun.desktop =&gt; windows
  file.separator =&gt; \

The up-to-date check says: CHECK_TURNED_OFF

Information relevant to JAVA_HOME related problems:

  JAVA_HOME is set to: C:\Fiji.app/java/win64/jdk1.6.0_24//jre
  imagej.dir =&gt; C:\Fiji.app

Information about the version of each plugin:

Activated update sites:
ImageJ: <a href="http://update.imagej.net/">http://update.imagej.net/</a> (last check:20141222150235)
Fiji: <a href="http://fiji.sc/update/">http://fiji.sc/update/</a> (last check:20150108023217)

Files not up-to-date:
  a6fb0af8 (MODIFIED) 20150113125324 jars/ij-1.49m.jar
  1aebacaa (LOCAL_ONLY) 20150113130207 macros/Individual/SNR.ijm
  7e29c562 (LOCAL_ONLY) 20150109131628 macros/Individual/Startup/StartupMacros.fiji.ijm
  f6de9c64 (LOCAL_ONLY) 20150109133030 macros/Individual/automerge.ijm
  ed5b891e (LOCAL_ONLY) 20150109133039 macros/Individual/autominmaxtif.ijm
  0eb63eff (LOCAL_ONLY) 20150109133044 macros/Individual/openzproject.ijm
  78d356ac (LOCAL_ONLY) 20150109133047 macros/Individual/regexmerge.ijm
  b730eee9 (MODIFIED) 20150113130514 macros/StartupMacros.fiji.ijm</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Wayne Rasband</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-01-13 19:45:46 CST
        </span>
      </div>



<pre class="bz_comment_text" >Your mini macro works as expected when I run it on ImageJ 1.49n. As a work around, try writing directly to the Results table, as in this example:

  run(&quot;Clear Results&quot;);
  for (i=1; i&lt;=3; i++)
     setResult(&quot;Header&quot;+i, 0, &quot;Data&quot;+i);
  setOption(&quot;ShowRowNumbers&quot;, false);
  updateResults;
  saveAs(&quot;Results&quot;, &quot;/Users/wayne/Results.csv&quot;);
  run(&quot;Close&quot;);</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">tokamoto
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-01-14 16:41:28 CST
        </span>
      </div>



<pre class="bz_comment_text" >I found that if you try and saveAs immediately after printing the last line, the command fails to run, but doesn't throw an error.  If you wait ~50 ms or use the selectWindow command it'll save correctly.

Unfortunately, I can't write directly to the results table. I'm saving multiple sets of results and need a permanent place to store this data.  

As a workaround, I found that saving as &quot;Text&quot; format works; it outputs a .txt file, not a .csv file as I would have preferred, but the extension can easily be changed.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Wayne Rasband</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-01-15 09:48:25 CST
        </span>
      </div>



<pre class="bz_comment_text" >Do you have a small test macro that reproduces this problem? The following macro works as expected when I run it on ImageJ 1.49n.

  run(&quot;Table...&quot;, &quot;name=Points width=400 height=200&quot;);
  print(&quot;[Points]&quot;, &quot;Header1, Header2, Header3&quot;);
  print(&quot;[Points]&quot;, &quot;Data1, Data2, Data3&quot;);
  saveAs(&quot;Results&quot;, &quot;/Users/wayne/Results.csv&quot;);
  run(&quot;Close&quot;);</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard">tokamoto
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-01-15 14:18:24 CST
        </span>
      </div>



<pre class="bz_comment_text" >I've re-created the issue in a macro that emulates my macro, and the steps that it takes through functions and saving to the tables.  

In my macro, I'm running the Measure tool on three separate selections on an image (emulated here by creating some random data) and then doing some calculations based on the results (emulated here by calculating the ratio and half ratio).  The results are saved on the first row in their own column, and then all three rows are printed to the Points table, replacing the space between data with commas.  Since I still have the ratios stored in variables, I print just the results to another table that excludes the raw measure data from earlier.  After it runs on all images in a directory(emulated here by just running it ten times) it selects the tables, saves them, and then closes them.

The macro below works on 1.49m, but not 1.49n.  If you comment out the close commands after the saveAs commands, you can see the tables have data in them.

setBatchMode(true);
setOption(&quot;ShowRowNumbers&quot;, false);
requires(&quot;1.49m&quot;);
run(&quot;Set Measurements...&quot;, &quot;area mean standard min median redirect=None decimal=3&quot;);
run(&quot;Input/Output...&quot;, &quot;jpeg=85 gif=-1 file=.csv save_column&quot;);
print(&quot;\\Clear&quot;);
run(&quot;Clear Results&quot;);
ratiovalue = 0;
half = 0;

//Initialize Tables
run(&quot;Table...&quot;, &quot;name=Points width=400 height=200&quot;);
run(&quot;Table...&quot;, &quot;name=Condensed width=400 height=200&quot;);
print(&quot;[Points]&quot;, &quot;Double, Value, Ratio, Ratio2&quot;);
print(&quot;[Condensed]&quot;, &quot;Number, Ratio, Ratio2&quot;);

//Run main function
testfunction();

updateResults;
//Save Tables
selectWindow(&quot;Points&quot;);
saveAs(&quot;Results&quot;, &quot;C:\\Users\\tokamoto\\Desktop\\Results_Points.csv&quot;);
run(&quot;Close&quot;);
selectWindow(&quot;Condensed&quot;);
saveAs(&quot;Results&quot;, &quot;C:\\Users\\tokamoto\\Desktop\\Results_Condensed.csv&quot;);
run(&quot;Close&quot;);

function testfunction() {
	for (i = 0; i &lt; 10; i++) { 
		for (n = 0; n &lt; 3; n++) { //Create three sets of random data
			setResult(&quot;Double&quot;, n, (n+1)*2);
			setResult(&quot;Value&quot;, n, random * 10);
		}
		updateResults();
		//Run the ratio function which separates the data and condenses it into the two tables
		ratio();
	}
}

function ratio() {
	//Calculate ratio
	ratiovalue = getResult(&quot;Double&quot;, nResults - 3) / getResult(&quot;Value&quot;, nResults - 3);
	half = ratiovalue / 2;
	//Set Results
	setResult(&quot;Ratio&quot;, 0, ratiovalue);
	setResult(&quot;Ratio2&quot;, 0, half);
	updateResults();
	//String manipulation and writing to table
	String.resetBuffer;
	String.copyResults;
	String.append(String.paste);
	print(&quot;[Points]&quot;, replace(String.buffer, &quot;	&quot;, &quot;, &quot;));
	run(&quot;Clear Results&quot;);

	//Save Condensed results (Just the ratio)
	setResult(&quot;Number&quot;, nResults, i);
	setResult(&quot;Ratio&quot;, 0, ratiovalue);
	setResult(&quot;Ratio2&quot;, 0, half);
	updateResults();
	String.resetBuffer;
	String.copyResults;
	String.append(String.paste);
	print(&quot;[Condensed]&quot;, replace(String.buffer, &quot;	&quot;, &quot;, &quot;));
	run(&quot;Clear Results&quot;);
}</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Wayne Rasband</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-01-15 20:28:55 CST
        </span>
      </div>



<pre class="bz_comment_text" >I can reproduce the problem using the latest test macro. The regression is fixed in the latest ImageJ daily build (1.49o24).</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        



</div>

</body>
</html>
