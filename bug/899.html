<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 899 &ndash; IJ2 under Vista: very long delay opening image file</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="">

  


  
    
      

      
      



    
    <link href="../css/global.css"
          rel="alternate stylesheet" 
          title="Classic"><link href="../css/global.css" rel="stylesheet"
        type="text/css" ><link href="../css/bug.css" rel="stylesheet"
        type="text/css" >

    <link href="../css/dusk.css" rel="stylesheet"
        type="text/css" title="Dusk">

    

    

    


    


    

    
    
    
  </head>



  <body onload=""
        class=" bz_bug bz_status_RESOLVED bz_product_Fiji bz_component_Plugins bz_bug_899 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;899</p>
    </td>

    <td id="subtitle">
      <p class="subheader">IJ2 under Vista: very long delay opening image file</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2015-10-26 13:51:58 CDT</p>
    </td>
</tr>
</table>


</div> 

<div id="notice">
  <table>
    <tr>
      <td style="font-size: 72px; color: firebrick; padding: 0 10px 0 10px">&#9888;</td>
      <td>
        <p style="margin: 0.4em">
        NOTICE! This is a static HTML version of a legacy Fiji BugZilla bug.
        </p>
        <p style="margin: 0.4em">
        The Fiji project now
        <a href="https://imagej.net/Issues">uses GitHub Issues</a> for issue tracking.
        </p>
        <p style="margin: 0.4em">
        Please
        <a href="https://github.com/fiji/fiji/issues/new">file all new issues</a>
        there.
        </p>
      </td>
    </tr>
  </table>
</div>

<div id="bugzilla-body">


<div class="bz_alias_short_desc_container edit_form">
     <a href="899.html"><b>Bug&nbsp;899</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">IJ2 under Vista: very long delay opening image file</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
  >Summary:</a>
</label>
</th>
          <td>IJ2 under Vista: very long delay opening image file
          </td>
        </tr>
      </table>
    </div>
  </div>
  
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a>Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Fiji</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Plugins</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">PC
       Windows
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a><u>I</u>mportance</a></label>:
      </th>
      <td>P4
       normal
      </td>
    </tr>            
          
          <tr>
      <th class="field_label">
        <a>Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
      </td>
    </tr>

    
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2014-08-13 09:20 CDT by <span class="vcard"><span class="fn">Chris</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2015-10-26 13:51 CDT 
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>4 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="ctrueden">ctrueden</option>
                <option value="imagej-bugs">imagej-bugs</option>
                <option value="johannes.schindelin">johannes.schindelin</option>
                <option value="stickfijibugs">stickfijibugs</option>
            </select>
        </div>
          
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    



  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments">






<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-13 09:20:39 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Hardware: Intel 4770K 4-core at 4.4 GHz, 3 GB memory

Old IJ1 --   (v 1.49e if I recall)
--------
Any small file (10mpx 3 MB JPG or 20 MB PNG) would snap-load in under 1 second.  

New IJ2
----------
With SCIFIO disabled, load time is ~10 seconds before image appears on screen.  All cores run high during this time.  Way too long to be useful.

With SCIFIO enabled, total load time is ~30 seconds before image appears on screen.  Unusable.
  &gt;&gt; There is no CPU activity (ie 1%) for 22 seconds, then all cores run high for ~10 seconds, and then the image appears.

COMMENTS
The same behavior occurs with macros loading files, causing very lethargic performance especially with Setbatchmode(false).  However, once a file is loaded, image processing functions like unsharp mask and gaussian blur appear to run at the same high speed of IJ1, so that part is OK.

Presumably, &quot;SCIFIO disabled&quot; should be legacy IJ1 compatible -- it is not even that.  Since I started using IJ2 a week ago, this is a serious setback because I no longer have throughput I had with IJ1.  Several updates have not resolved so I bring it to yor attention.  Thank you.

Information about your version of Java:

  os.arch =&gt; x86
  os.name =&gt; Windows Vista
  os.version =&gt; 6.0
  java.version =&gt; 1.6.0_24
  java.vendor =&gt; Sun Microsystems Inc.
  java.runtime.name =&gt; Java(TM) SE Runtime Environment
  java.runtime.version =&gt; 1.6.0_24-b07
  java.vm.name =&gt; Java HotSpot(TM) Client VM
  java.vm.version =&gt; 19.1-b02
  java.vm.vendor =&gt; Sun Microsystems Inc.
  java.vm.info =&gt; mixed mode
  java.awt.graphicsenv =&gt; sun.awt.Win32GraphicsEnvironment
  java.specification.name =&gt; Java Platform API Specification
  java.specification.version =&gt; 1.6
  sun.cpu.endian =&gt; little
  sun.desktop =&gt; windows
  file.separator =&gt; \

The up-to-date check says: REMIND_LATER

Information relevant to JAVA_HOME related problems:

  JAVA_HOME is set to: C:\Users\chris\Programs\Fiji.app/java/win32/jdk1.6.0_24//jre
  imagej.dir =&gt; C:\Users\chris\Programs\Fiji.app

Information about the version of each plugin:

Activated update sites:
ImageJ: <a href="http://update.imagej.net/">http://update.imagej.net/</a> (last check:20140812134706)
Fiji: <a href="http://fiji.sc/update/">http://fiji.sc/update/</a> (last check:20140808140226)

Files not up-to-date:
  a7f56258 (LOCAL_ONLY) 20131108015300 macros/cjb_4x4_DoAll_(3648x2736)to(1280x960).ijm
  67ead821 (LOCAL_ONLY) 20131108124601 macros/cjb_4x4_deconv3_(3648x2736)to(1920x1440).ijm
  28326cd8 (LOCAL_ONLY) 20131109053300 macros/cjb_4x4_stitch3_(1920x1440)to(1280x960).ijm
  16069083 (LOCAL_ONLY) 20131107024712 macros/cjb_DEPRECATED/cjb_4x4_deconv1_(3648x2736)to(1920x1440).ijm
  db92b79f (LOCAL_ONLY) 20131107152109 macros/cjb_DEPRECATED/cjb_4x4_deconv2_(3648x2736)to(1920x1440).ijm
  ea29c5b8 (LOCAL_ONLY) 20131107160821 macros/cjb_DEPRECATED/cjb_4x4_stitch2_(1920x1440)to(1280x960).ijm
  b50a9a74 (LOCAL_ONLY) 20131107041247 macros/cjb_DEPRECATED/cjb_4x4_stitch_(1920x1440)to(1280x960).ijm
  94e93757 (LOCAL_ONLY) 20131024100624 macros/cjb_DEPRECATED/cjb_deconv1_(3648x2736)to(1920x1440).ijm
  7eec3aa4 (LOCAL_ONLY) 20131109200335 macros/cjb_MxN_DoAll_1.ijm
  1d394c95 (LOCAL_ONLY) 20131110193310 macros/cjb_MxN_DoAll_2.ijm
  1424b4bb (LOCAL_ONLY) 20131114234949 macros/cjb_MxN_DoAll_3.ijm
  af38f778 (LOCAL_ONLY) 20131110010243 macros/cjb_MxN_deconv_1.ijm
  d4c84608 (LOCAL_ONLY) 20131110022739 macros/cjb_MxN_deconv_2.ijm
  646d46de (LOCAL_ONLY) 20131117181437 macros/cjb_MxN_deconv_3.ijm
  1b4d0706 (LOCAL_ONLY) 20131109224120 macros/cjb_MxN_stitch_1.ijm
  4b1d620b (LOCAL_ONLY) 20131110131851 macros/cjb_MxN_stitch_2.ijm
  96ae2566 (LOCAL_ONLY) 20131111000936 macros/cjb_MxN_stitch_3.ijm
  5e7df4d9 (LOCAL_ONLY) 20131025002740 macros/cjb_Quit.ijm
  0f17b9ec (LOCAL_ONLY) 20140804095937 macros/cjb_RGB_shift.ijm
  2c445345 (LOCAL_ONLY) 20140101082855 macros/cjb_beads_01.ijm
  262bc3ff (LOCAL_ONLY) 20140804084659 macros/cjb_deconv_profile_01.ijm
  d9ebe757 (LOCAL_ONLY) 20131028111802 macros/cjb_flat_field_1.ijm
  5022304f (LOCAL_ONLY) 20140514102917 macros/cjb_proc_flr_image.ijm
  dbf434fa (LOCAL_ONLY) 20140804151032 macros/cjb_restore_1.ijm
  0d62acf8 (LOCAL_ONLY) 20140811213028 macros/cjb_restore_2.ijm
  0b936a76 (LOCAL_ONLY) 20140812211831 macros/cjb_restore_3.ijm
  2c9f6e58 (LOCAL_ONLY) 20140813085252 macros/cjb_restore_4.ijm
  6d02d259 (LOCAL_ONLY) 20131105023524 macros/cjb_test.ijm
  52e4f6be (LOCAL_ONLY) 20140803160222 macros/cjb_test_sharpen.ijm
  8b86ad73 (LOCAL_ONLY) 20131128004341 macros/cjb_test_yellow.ijm
  59ed901f (LOCAL_ONLY) 20131108012234 macros/test_remote.ijm</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-13 09:32:07 CDT
        </span>
      </div>



<pre class="bz_comment_text" >edit:
  &gt;&gt; File-&gt;Open.  After &lt;enter&gt; there is no CPU activity (ie 1%) for 22 seconds, then all cores run high for ~10 seconds, and then the image appears.</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-13 10:13:46 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Example of macro lethargy.  With IJ1 my image processing macro executed in a very respectable 6-7 seconds.  

In IJ2 with SCIFIO disabled, the same macro takes ~15 seconds to execute, high CPU activity for the full 15 seconds.  

With SCIFIO enabled [with setBatchMode(true), images suppressed], that jumps to 50 seconds.  There is the 22-second CPU idle period but it occurs after ~8 seconds into the macro.  It's as though IJ2 waits for ~22 seconds before resuming high CPU activity for the remainder 20 seconds of the macro (total 50 seconds).

The timings of this strange activity seem related to manual Open, but are &quot;inverted.&quot;</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-13 10:48:44 CDT
        </span>
      </div>



<pre class="bz_comment_text" >In short, there are two issues IJ2:
  1 - 10X longer image file open times (10s vs 1s of IJ1)
  2 - an additional 22-second CPU idle time when SCIFIO is enabled during File Open and during a macro that opens an image file.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-13 12:19:28 CDT
        </span>
      </div>



<pre class="bz_comment_text" >The delay behavior is worst, ie most obvious, when opening regular JPG files.  Mine are 10 mpx image files, typically 2-4 MB JPGs.</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-14 17:14:11 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Thanks for the excellent bug report, Stick. This is a very serious issue which we will address as soon as possible.</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-14 19:13:30 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Sure Curtis, my pleasure.  

Also useful (give 'im an inch and he'll take a mile) .... if you or a colleague are dabbling in that area, it would be useful to give us a programmatic get/set of SCIFIO flag, eg. flag = getSCIFIOflag().  The reason macro knowledge is needed is that SCIFIO seems to treat some files differently with SCIFIO disabled (like IJ1).  

For example, with SCIFIO off, a 16-bit PNG gets opened in IJ1 style as an 8-bit RGB (like an 8-bit JPG), with I presume resolution loss due to mapping to lo-res.  With SCIFIO on, the same PNG file is opened as a 3-plane hyperstack (with the 1/3 etc color slider on bottom) preserving its original 16-bit per plane resolution.  

However, that results in a different window naming convention for SCIFIO ON|OFF after I do &quot;Split Channels&quot; for either state, which I then have to handle with different code paths (that's OK).  While true 16-bittiness offered by SCIFIO is very welcome, at present, without knowing SCIFIO state programmatically, I can't automate subsequent image processing.

Thanks.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-15 08:21:27 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Please file an issue at <a href="https://github.com/imagej/imagej-legacy/issues">https://github.com/imagej/imagej-legacy/issues</a> for the feature request regarding macro interrogation of the SCIFIO status.

As for this bug, I think I found the problem, and I fear it will take some work to resolve properly. A stack trace during the initial display of a largish image shows:

&quot;Open...&quot; prio=4 tid=11c85d000 nid=0x128101000 runnable [1280ff000]
   java.lang.Thread.State: RUNNABLE
	at net.imglib2.display.projector.composite.CompositeXYProjector.map(CompositeXYProjector.java:193)
	at net.imagej.display.DefaultDatasetView.rebuild(DefaultDatasetView.java:401)
	- locked &lt;6d1c538f8&gt; (a net.imagej.display.DefaultDatasetView)
	at net.imagej.display.DefaultImageDisplay.rebuild(DefaultImageDisplay.java:136)
	at net.imagej.display.DefaultImageDisplay.display(DefaultImageDisplay.java:274)

This is in the ImageJ2 display layer: it is trying to build a projection of the image for use in the ImageJ2 UI, even though that UI is inactive. In other words: ImageJ is doing twice as much work as necessary, rendering both the IJ1 and IJ2 image planes. Furthermore, the IJ2/ImgLib2 rendering layer is very much unoptimized at the moment, so the (unnecessary!) IJ2 part of that work tanks performance rather severely, especially with images over 1 MPx.

The proper fix is to render image data on the IJ2 side only as needed to actually paint pixels. But we'll need another design iteration of the display architecture (which has numerous problems) in order to accommodate that.

In the meantime, I'll see about putting a hack somewhere to suppress this undesirable behavior.</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-15 10:11:25 CDT
        </span>
      </div>



<pre class="bz_comment_text" >To avoid this sort of issue for most users most of the time, I added a toggle to the ImageJ2 options. Work (unfinished) is at:

   <a href="https://github.com/imagej/imagej-legacy/compare/ij2-sync">https://github.com/imagej/imagej-legacy/compare/ij2-sync</a>

I'll file a PR when it's ready.</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-15 14:55:31 CDT
        </span>
      </div>



<pre class="bz_comment_text" >There is now a tentative fix:
  <a href="https://github.com/imagej/imagej-legacy/pull/82">https://github.com/imagej/imagej-legacy/pull/82</a>

Some testing would be helpful. If you check out the branch, you can build using &quot;mvn clean package&quot; and then copy &quot;target/imagej-legacy-0.8.2-SNAPSHOT.jar&quot; into your ImageJ.app/jars, deleting the old &quot;target/imagej-legacy-0.8.1.jar&quot;.

If you then launch ImageJ and run Edit &gt; Options &gt; ImageJ2 you'll see a new option, &quot;Enable ImageJ2 data structures&quot;, off by default. As long as that option stays off, performance _should_ return to what it was in the pure IJ1 days.

I tested this only lightly, since I am actually out of the office today. We will do more thorough testing on Monday, and if all is well, merge and release.</pre>
    </div><div id="c10" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-16 09:16:27 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Curtis, I'm not sure if your previous comment was intended for me, but I expect I don't have js build capability, unless it's included by default in the java package that runs fiji in Vista and there's a way of getting at it that I don't know.  

Nonetheless, this morning I am noting these differences:

  a) There is no new toggle (yet, expected I suppose) in Options-&gt;ImageJ that you describe.

With SCIFIO enabled .....
    
  b) If I manually open a 10 mpx 3 MB JPG there is still that 22s of CPU idle time before the image appears.  It takes a total of ~35s for the image to show up.

  c) But, if I open a 16-bit 40 MB PNG version of the same image, it shows up in ~12s with no idle time -- much better.  So there must be an improvement here.

  d) The macro that executed in ~50s a few days ago now runs in ~30s.  I see cores run high with no ~22s CPU idle time, so the idle time appears to be eliminated.  The interesting thing here is that there is no idle time either for PNGs or JPGs, which is curious because with PNGs performance agrees with (c) but for JPGs contradicts (b), to the better of course!

Moral of the story ... if you can make (b) work like (c) then I expect (not tested yet) that SetBatchMode(false) for debugging my macros will give me better performance too.</pre>
    </div><div id="c11" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-16 09:31:24 CDT
        </span>
      </div>



<pre class="bz_comment_text" >After some more thought, the &quot;curiosity&quot; in (d) vs (b) seems to be related to setBatchMode().  I am wondering if what I'm reporting above makes any sense.</pre>
    </div><div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-18 16:56:34 CDT
        </span>
      </div>



<pre class="bz_comment_text" >I uploaded the fix. So now you can test simply by running Help &gt; Update and installing the updates.

Chris, I am not sure why you saw a discrepancy in your second round of testing, since this fix was not yet uploaded to the ImageJ update site. Perhaps there is an intermittent timing issue. But in any case, the fix should completely sidestep the issue, returning the behavior to pre-ImageJ2 days unless you explicitly toggle ImageJ2 syncing and/or SCIFIO in the Edit &gt; Options &gt; ImageJ2... dialog (which I would not recommend doing at this time).</pre>
    </div><div id="c13" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-18 21:36:19 CDT
        </span>
      </div>



<pre class="bz_comment_text" >RESULTS
-------

IJ2 data structs OFF
SCIFIO ON

Manually open 3 MB 10 mpx JPG:  12s, no CPU idle
Manually open 40 MB 10 mpx 16-bit PNG: 12s, no CPU idle
Macro with 16-bit PNG: 28s, no CPU idle
Macro with JPG: not supported format (expected - due to SCIFIO not being detected yet in my macro)

IJ2 data structs OFF
SCIFIO OFF

Manually open 3 MB 10 mpx JPG:  less than 1s - crazy good
Manually open 40 MB 10 mpx 16-bit PNG: less than 2s -- crazy good
Macro with 16-bit PNG:  not supported format (expected - due to SCIFIO not being detected yet in my macro)
Macro with JPG: 18s, OK, passes

IJ2 data structs ON
SCIFIO ON

Manually open 3 MB 10 mpx JPG:  11s, no CPU idle
Manually open 40 MB 10 mpx 16-bit PNG: 11s, no CPU idle
Macro with 16-bit PNG: 28s, no CPU idle
Macro with JPG: 28s, no CPU idle

COMMENTS
--------
It looks like the new switch works.  Despite the switch, the nice thing now is that the 22s CPU idle is gone everywhere, even though I understand you didn't find it.  So it may come back to haunt us.  The issue remains also with the long file loads with IJ2 structs ON, basically ~10 sec vs ~1 sec (potential CPU idle lurking gremlin notwithstanding).  Right now thus, I would not be able to make decent use of SCIFIO on the macros where I read upwards of 36 of these image files.  Please give a heads up if you fix the load delay.</pre>
    </div><div id="c14" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-19 11:02:50 CDT
        </span>
      </div>



<pre class="bz_comment_text" >If you do [test #3 JPG macro] minus [test #2 JPG macro], you get 28s-18s = 10s, the file load overhead caused by SCIFIO ON during manual load.   If you can get rid of that overhead, you'll be back to the performance of IJ1 but with the nice features of IJ2 SCIFIO.  Looking forward to a solution.
All the best,
Chris.</pre>
    </div><div id="c15" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Schindelin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-19 12:08:06 CDT
        </span>
      </div>



<pre class="bz_comment_text" ><span class="quote">&gt; Looking forward to a solution.</span >

Note that this is an Open Source project. That means that you can make happen what you desire to see. Or you can wait and lean on volunteers to do the work for you, at a time when their goals match yours. It is fundamentally *your* choice which route you choose.</pre>
    </div><div id="c16" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-20 08:53:53 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Johannes, while I know this is open source and for features specific to my projects that could also help a small group of others, I would be responsible in crafting out.  If I am not mistaken the move to IJ2 and its features was funded by the NIH, and that I presume must have been funneled to a core group of developers.  Whether Curtis is one or he could be working on IJ2 for other reasons, I don't know because I did not ask.  But who ever implemented the new functionality that impacts everyone using IJ2 at the *front* end, should be the one interested in my bug report and improve his code.  There is a good reason why there is a bug report facility in Fiji and that is what I understand it to be.</pre>
    </div><div id="c17" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-21 13:27:53 CDT
        </span>
      </div>



<pre class="bz_comment_text" >To interrogate whether SCIFIO is active in your ImageJ, you can use the OptionsService API. Here is an example Jython script:

  # &#64;OptionsService optionsService
  from net.imagej.legacy import ImageJ2Options
  scifio = optionsService.getOptions(ImageJ2Options).isSciJavaIO()
  print(&quot;SCIFIO? &quot; + str(scifio))

The same approach should work with any scripting language _except_ for ImageJ 1.x macros, since they do not support access to the complete Java API of ImageJ etc.

Regarding performance improvements to SCIFIO and ImageJ-Legacy: yes, they are certainly needed and planned, and will remain on the radar. But it requires a substantial retooling of the ImageJ-Common library, among other involved efforts. Thus, due to limited developer resources, I cannot promise a timeline.

Since improving SCIFIO performance is more of a feature request than a bug, and since there is a simple workaround to any performance issues (i.e.: turn off SCIFIO and ImageJ2 data structures), I am closing this bug as resolved.

In the meantime, for your 16-bit PNGs, you can force use SCIFIO via File &gt; Import &gt; Image... (way at the bottom of the menu! or use the Command Finder by pressing L). That way you can at least write a macro that will support all your images via case logic.</pre>
    </div><div id="c18" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Chris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-21 14:57:24 CDT
        </span>
      </div>



<pre class="bz_comment_text" >I'm not yet at the level of coding Jython and the like, but I appreciate your solution offer and will return to this thread when I get up to speed.  So far macros have been working very well for me, are fast to develop and are easy to debug because of their tight relationship with menu commands. 

WRT to 16-bit PNGs ...&quot;you can force use SCIFIO via File &gt; Import &gt; Image... (way at the bottom of the menu!&quot;

Yes nice, I tried this from the menu and it worked ... I turned OFF both SCIFIO and IJ2 structs and Fiji presented the image in full 16-bit, as though both options were ON.  The same 10s delay takes place but it worked.  I got excited because this looked like a good solution for both the many 1-second JPGs and the hi-res solitary PNG as needed, but alas, macro record emitted only this line:
   run(&quot;Image... &quot;)
without file information or other parameters in the window.  It's as though the macro script is incomplete for the command???</pre>
    </div><div id="c19" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-08-21 15:08:53 CDT
        </span>
      </div>



<pre class="bz_comment_text" ><span class="quote">&gt; alas, macro record emitted only this line: run(&quot;Image... &quot;) without
&gt; file information or other parameters in the window.  It's as though
&gt; the macro script is incomplete for the command???</span >

Right, I forgot that ImageJ2 commands do not record properly yet. The issue is that ImageJ2 commands are _not_ ImageJ 1.x plugins, and need separate handling for the recorder to emit something sensible.

It's been a known issue for quite some time, but AFAIK there was no existing issue for it. So I filed one:
   <a href="https://github.com/imagej/imagej-legacy/issues/87">https://github.com/imagej/imagej-legacy/issues/87</a>

And unfortunately, no workaround for this problem occurs to me at the moment.</pre>
    </div><div id="c20" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Curtis Rueden</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2015-10-26 13:51:58 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Just a quick note that ImageJ2 commands such as File &gt; Import &gt; Image... were made fully macro recordable a few months ago.

See the GitHub issue (<a href="https://github.com/imagej/imagej-legacy/issues/87">https://github.com/imagej/imagej-legacy/issues/87</a>; now closed) for details.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        



</div>

</body>
</html>
