<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 383 &ndash; fiji fails to start when isntalled from experimental repository</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="">

  


  
    
      

      
      



    
    <link href="../css/global.css"
          rel="alternate stylesheet" 
          title="Classic"><link href="../css/global.css" rel="stylesheet"
        type="text/css" ><link href="../css/bug.css" rel="stylesheet"
        type="text/css" >

    <link href="../css/dusk.css" rel="stylesheet"
        type="text/css" title="Dusk">

    

    

    


    


    

    
    
    
  </head>



  <body onload=""
        class=" bz_bug bz_status_CLOSED bz_product_Fiji bz_component_Debian_Packages bz_bug_383 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;383</p>
    </td>

    <td id="subtitle">
      <p class="subheader">fiji fails to start when isntalled from experimental repository</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2011-11-30 18:33:28 CST</p>
    </td>
</tr>
</table>


</div> 

<div id="notice">
  <table>
    <tr>
      <td style="font-size: 72px; color: firebrick; padding: 0 10px 0 10px">&#9888;</td>
      <td>
        <p style="margin: 0.4em">
        NOTICE! This is a static HTML version of a legacy Fiji BugZilla bug.
        </p>
        <p style="margin: 0.4em">
        The Fiji project now
        <a href="https://imagej.net/Issues">uses GitHub Issues</a> for issue tracking.
        </p>
        <p style="margin: 0.4em">
        Please
        <a href="https://github.com/fiji/fiji/issues/new">file all new issues</a>
        there.
        </p>
      </td>
    </tr>
  </table>
</div>

<div id="bugzilla-body">


<div class="bz_alias_short_desc_container edit_form">
     <a href="383.html"><b>Bug&nbsp;383</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">fiji fails to start when isntalled from experimental repository</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
  >Summary:</a>
</label>
</th>
          <td>fiji fails to start when isntalled from experimental repository
          </td>
        </tr>
      </table>
    </div>
  </div>
  
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a>Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">CLOSED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Fiji</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Debian Packages</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">PC
       Linux
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a><u>I</u>mportance</a></label>:
      </th>
      <td>P2
       normal
      </td>
    </tr>            
          
          <tr>
      <th class="field_label">
        <a>Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Mark Longair</span>
</span>
      </td>
    </tr>

    
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2011-11-25 09:35 CST by <span class="vcard"><span class="fn">Alex Mestiashvili</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2011-11-30 18:33 CST 
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>1 
          user
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="johannes.schindelin">johannes.schindelin</option>
            </select>
        </div>
          
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    



  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments">






<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Mestiashvili</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-25 09:35:41 CST
        </span>
      </div>



<pre class="bz_comment_text" >On Ubuntu 10.04 Lucid AMD64 

after installation from <a href="http://pacific.mpi-cbg.de/downloads/apt-experimental/">http://pacific.mpi-cbg.de/downloads/apt-experimental/</a>

fiji fails to start , java throws the following exceptions:

$fiji
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: javassist/CannotCompileException
	at fiji.Main.premain(Main.java:67)
	at fiji.Main.main(Main.java:107)
Caused by: java.lang.ClassNotFoundException: javassist.CannotCompileException
	at java.net.URLClassLoader$1.run(URLClassLoader.java:217)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:205)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:321)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:294)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:266)
	... 2 more</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mark Longair</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-25 11:21:47 CST
        </span>
      </div>



<pre class="bz_comment_text" >Ouch - sorry, I should have spotted this.  I'm copying Johannes, who added the javassist patching of ImageJ, since I'm not familiar with how that works.  Would I be right in guessing this may be to do with ij.jar not being writable in the packaged version?</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Mestiashvili</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-25 11:42:03 CST
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="#c1">comment #1</a>)
<span class="quote">&gt; Ouch - sorry, I should have spotted this.  I'm copying Johannes, who added the
&gt; javassist patching of ImageJ, since I'm not familiar with how that works. 
&gt; Would I be right in guessing this may be to do with ij.jar not being writable
&gt; in the packaged version?
&gt; </span >

Hello , 
I have no idea to be honest , could it be that it is a more general problem ? 
I  cloned the git repository and tried to build packages but build process failed with  fuji --update throwing 
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: com/jcraft/jsch/UserInfo

libjsch-java is installed on the system 

dpkg -L libjsch-java 
&lt;skip&gt;
...
/usr/share/java/jsch-0.1.42.jar
/usr/share/maven-repo/com/jcraft/jsch/0.1.42/jsch-0.1.42.jar
/usr/share/maven-repo/com/jcraft/jsch/debian/jsch-debian.jar
/usr/share/java/jsch.jar

Alex </pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Schindelin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-26 03:54:24 CST
        </span>
      </div>



<pre class="bz_comment_text" >The problem is that we now require javassist in the classpath. I changed fiji.c accordingly. With the next update, Fiji should work again!</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Mestiashvili</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-29 09:50:35 CST
        </span>
      </div>



<pre class="bz_comment_text" >Thank you for fixing , 

I had to add jsch.jar to classpath to build packages from the git repository 

after built I could run fiji without problem .

so here is the patch :

diff --git a/fiji.c b/fiji.c
index 8906226..5237bc3 100644
--- a/fiji.c
+++ b/fiji.c
&#64;&#64; -2458,6 +2458,8 &#64;&#64; static void parse_command_line(void)
                        skip_build_classpath = 1;
                        string_append_path_list(class_path, fiji_path(&quot;plugins/Fiji_Updater.jar&quot;));
                        string_append_path_list(class_path, fiji_path(&quot;jars/jsch-0.1.44.jar&quot;));
+                       //Debian
+                       string_append_path_list(class_path, &quot;/usr/share/java/jsch.jar&quot;);
                        main_class = &quot;fiji.updater.Main&quot;;
                }
                else if (handle_one_option(&amp;i, &quot;--class-path&quot;, arg) ||


Thank you , 
Alex </pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mark Longair</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-29 10:09:42 CST
        </span>
      </div>



<pre class="bz_comment_text" >The Debian packages from experimental work properly again as of today's build.  Thanks for reporting that.

The issue that you raise with building from the git repository is completely separate, and I can't reproduce it.  jsch.jar should either be built from the modules/jsch submodule (if that submodule is initialized and updated) or will be copied into place from the precompiled subdirectory.</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Mestiashvili</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-29 10:21:36 CST
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="#c5">comment #5</a>)
<span class="quote">&gt; The Debian packages from experimental work properly again as of today's build. 
&gt; Thanks for reporting that.
&gt; 
&gt; The issue that you raise with building from the git repository is completely
&gt; separate, and I can't reproduce it.  jsch.jar should either be built from the
&gt; modules/jsch submodule (if that submodule is initialized and updated) or will
&gt; be copied into place from the precompiled subdirectory.
&gt; </span >

confirm that it works. just had to run apt-get update one more time :) .
Thank you and have a nice day , 
Alex 

</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Schindelin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-29 18:11:48 CST
        </span>
      </div>



<pre class="bz_comment_text" >Thanks Alex for your patch. I actually had exactly the same diff in my worktree but then decided against committing it. Why? Because the diff in question only applies for the --update subcommand of Fiji and all the diff does is to support getting jsch.jar from the default location in Debian setups.

But in Debian setups, you're not supposed to be _able_ to update via the --update command. It should refuse to update due to missing privileges to write to the Fiji directory. Even if started with write permission to the Fiji directory, it would modify files that the Debian packages want to update. Worse, it could lead to a classpath conflict due to .jar files that might override files installed via apt-get.

So while I appreciate that you put in so much work, I hope you agree that this patch should not be applied?

Thanks!</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Mestiashvili</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-30 18:05:25 CST
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="#c7">comment #7</a>)
<span class="quote">&gt; Thanks Alex for your patch. I actually had exactly the same diff in my worktree
&gt; but then decided against committing it. Why? Because the diff in question only
&gt; applies for the --update subcommand of Fiji and all the diff does is to support
&gt; getting jsch.jar from the default location in Debian setups.
&gt; 
&gt; But in Debian setups, you're not supposed to be _able_ to update via the
&gt; --update command. It should refuse to update due to missing privileges to write
&gt; to the Fiji directory. Even if started with write permission to the Fiji
&gt; directory, it would modify files that the Debian packages want to update.
&gt; Worse, it could lead to a classpath conflict due to .jar files that might
&gt; override files installed via apt-get.
&gt; </span >
but &quot;fiji  --update&quot; is executed during the build process 

I just repeated it - cloned the repossitory , renamed it to fiji-20111129094958
and run debuild -us -uc 
and got the following result :

Building (fiji.build.ExecuteProgram) jars/imglib2.jar &lt;- jars/Fiji...
Executing: './fiji' '--update' 'update' 'jars/imglib2.jar'
No GUI detected.  Falling back to headless mode.
Found that JAVA_HOME was: '/usr/lib/jvm/java-6-openjdk//jre'
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: com/jcraft/jsch/UserInfo
Caused by: java.lang.ClassNotFoundException: com.jcraft.jsch.UserInfo
        at java.net.URLClassLoader$1.run(URLClassLoader.java:217)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:205)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:321)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:294)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:266)
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:334)
Could not find the main class: fiji.updater.Main. Program will exit.
Program failed: './fiji --update update $TARGET'
Failed: 1
        in rule (fiji.build.ExecuteProgram) jars/imglib2.jar &lt;- jars/Fiji...
        in rule (fiji.build.SubFake) jars/imglib2.jar &lt;- modules/imglib/
        in rule (fiji.build.All) all &lt;- fiji jars/ij.jar plugins/loci_too...
make: *** [build-arch-stamp] Error 1
dpkg-buildpackage: error: debian/rules build gave error exit status 2
debuild: fatal error at line 1340:
dpkg-buildpackage -rfakeroot -D -us -uc failed


<span class="quote">&gt; So while I appreciate that you put in so much work, I hope you agree that this
&gt; patch should not be applied?</span >

I am totally ok with that :) 
<span class="quote">&gt; 
&gt; Thanks!
&gt; </span >

Thank you for the packages !

Alex </pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mark Longair</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-30 18:33:28 CST
        </span>
      </div>



<pre class="bz_comment_text" >Alex,

The problem you're seeing there is because the Debian packages aren't built directly from the git repository - there are scripts that rewrite various build files to produce the Debian source package.

If you just want to build the Debian packages yourself, you can do:

    apt-get build-dep fiji
    apt-get source fiji

... then:

    cd fiji-[whatever]
    dpkg-buildpackage -rfakeroot -us -uc

If you're interested in how the Debian source files are generated from the standard Fiji source tree, you can look at:

    <a href="http://fiji.sc/cgi-bin/gitweb.cgi?p=fiji.git;a=blob;f=debian/complete-build;hb=refs/heads/master">http://fiji.sc/cgi-bin/gitweb.cgi?p=fiji.git;a=blob;f=debian/complete-build;hb=refs/heads/master</a>

... but I honestly don't recommend that, it's pretty horrible.

regards,
mark</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        



</div>

</body>
</html>
