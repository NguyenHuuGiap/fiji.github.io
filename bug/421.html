<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 421 &ndash; Image values of zero not correctl in Image Calculator when binarized image is calculated with a non-binarized one on 64-bit Mac FIJI ImageJ 1.46j with JAVA 1.6.0_29</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="">

  


  
    
      

      
      



    
    <link href="../css/global.css"
          rel="alternate stylesheet" 
          title="Classic"><link href="../css/global.css" rel="stylesheet"
        type="text/css" ><link href="../css/bug.css" rel="stylesheet"
        type="text/css" >

    <link href="../css/dusk.css" rel="stylesheet"
        type="text/css" title="Dusk">

    

    

    


    


    

    
    
    
  </head>



  <body onload=""
        class=" bz_bug bz_status_RESOLVED bz_product_Fiji bz_component_Other bz_bug_421 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;421</p>
    </td>

    <td id="subtitle">
      <p class="subheader">Image values of zero not correctl in Image Calculator when binarized image is calculated with a non-binarized one on 64-bit Mac FIJI ImageJ 1.46j with JAVA 1.6.0_29</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2012-06-07 10:38:56 CDT</p>
    </td>
</tr>
</table>


</div> 

<div id="notice">
  <table>
    <tr>
      <td style="font-size: 72px; color: firebrick; padding: 0 10px 0 10px">&#9888;</td>
      <td>
        <p style="margin: 0.4em">
        NOTICE! This is a static HTML version of a legacy Fiji BugZilla bug.
        </p>
        <p style="margin: 0.4em">
        The Fiji project now
        <a href="https://imagej.net/Issues">uses GitHub Issues</a> for issue tracking.
        </p>
        <p style="margin: 0.4em">
        Please
        <a href="https://github.com/fiji/fiji/issues/new">file all new issues</a>
        there.
        </p>
      </td>
    </tr>
  </table>
</div>

<div id="bugzilla-body">


<div class="bz_alias_short_desc_container edit_form">
     <a href="421.html"><b>Bug&nbsp;421</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">Image values of zero not correctl in Image Calculator when binarized image is calculated with a non-binarized one on 64-bit Mac FIJI ImageJ 1.46j with JAVA 1.6.0_29</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
  >Summary:</a>
</label>
</th>
          <td><span title="Image values of zero not correctl in Image Calculator when binarized image is calculated with a non-binarized one on 64-bit Mac FIJI ImageJ 1.46j with JAVA 1.6.0_29">Image values of zero not correctl in Image Calculator when binarized image is...
        </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a>Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Fiji</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Other</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">Macintosh
       Mac OS
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority" accesskey="i">
          <a><u>I</u>mportance</a></label>:
      </th>
      <td>P2
       major
      </td>
    </tr>            
          
          <tr>
      <th class="field_label">
        <a>Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">ImageJ Bugs Mailing List</span>
</span>
      </td>
    </tr>

    
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
          <a href="http://www.zshare.ma/6yctogzseq5p">http://www.zshare.ma/6yctogzseq5p</a>
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2012-04-27 15:16 CDT by <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2012-06-07 10:38 CDT 
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>0 
          users
        <div id="cc_edit_area">
          <br>
        </div>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    


<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_application_octet-stream">
        <td valign="top">
            <a href="../attach/58/Test1.ijm"
               title="View the content of the attachment">
          <b>Macro to test for the bug</b></a>

          <span class="bz_attach_extra_info">
              (551 bytes,
                application/octet-stream)

            <br>
            <a href="#attach_58"
               title="Go to the comment associated with the attachment">2012-05-14 15:07 CDT</a>,

            <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
          </span>
        </td>


        <td valign="top">
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_application_vnd.ms-excel">
        <td valign="top">
            <a href="../attach/59/Results1.xls"
               title="View the content of the attachment">
          <b>Results showing the bug in effect</b></a>

          <span class="bz_attach_extra_info">
              (836 bytes,
                application/vnd.ms-excel)

            <br>
            <a href="#attach_59"
               title="Go to the comment associated with the attachment">2012-05-14 15:09 CDT</a>,

            <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
          </span>
        </td>


        <td valign="top">
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_application_vnd.ms-excel">
        <td valign="top">
            <a href="../attach/60/Results_manual1.xls"
               title="View the content of the attachment">
          <b>Results when the bug is not in effect</b></a>

          <span class="bz_attach_extra_info">
              (728 bytes,
                application/vnd.ms-excel)

            <br>
            <a href="#attach_60"
               title="Go to the comment associated with the attachment">2012-05-14 15:09 CDT</a>,

            <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
          </span>
        </td>


        <td valign="top">
        </td>
      </tr>

  </table>
<br>

  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments">






<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-27 15:16:19 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Using FIJI (updated 19.4.2012) ImageJ 1.46j with JAVA 16.0_29 on a 64-bit Mac the image value of zero (0) was not calculated as zero in Image Calculator. When .zvi images with 12-bit image dynamics (shown as 16-bits) were imported and one of them was thresholded and binarized (and converted automatically to 8-bit) and the calculated to another (in original 16-bit format)the results of AND or multiplication or subtraction at areas of zero value on the binarized were spurious. In the AND &amp; multiplication results the areas had non-zero values and in the subtracted results the values were lower then on the non-binarized image (like a positive value had been subtracted from them). 

The same process was tested on an older version of ImageJ on the same computer and on two other computers (64-bit Win7 FIJI ImageJ 1.46j JAVA 1.6.0_24 and 32-bit WinXP FIJI ImageJ 1.46j JAVA 1.6.0_20) and was not reproduced on those. It was reproduced on the original test version after software restart.</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Schindelin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-04-27 15:45:27 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Could you please provide a macro reproducing the issue? It should be enough to generate two 1x1 images and use the Set... function to force the values in your original images.

It would be greatly appreciated!</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Schindelin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-12 06:21:51 CDT
        </span>
      </div>



<pre class="bz_comment_text" >This report is not valid until the time when an easy to reproduce macro is provided. Otherwise it would be asking the developers to go on a wild goose chase, which would be unreasonable given that they have so much more they need to do. In other words, this developer uses communication and feedback as an indicator just how badly someone needs a fix.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-14 15:07:36 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="../attach/58/Test1.ijm" name="attach_58" title="Macro to test for the bug">attachment 58</a></span>
Macro to test for the bug

&quot;Test1.ijm&quot; is a macro recording of the workflow that is affected by the bug.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-14 15:09:19 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="../attach/59/Results1.xls" name="attach_59" title="Results showing the bug in effect">attachment 59</a></span>
Results showing the bug in effect

&quot;Results1.xls&quot; shows the results of the process when the bug is in effect (measurements close to zero).</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-14 15:09:53 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class=""><a href="../attach/60/Results_manual1.xls" name="attach_60" title="Results when the bug is not in effect">attachment 60</a></span>
Results when the bug is not in effect

&quot;Results_manual1.xls&quot; show the results of the process when it was manually repeated on a different machine (measurements as expected).</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jussi Kenkkilä</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-05-14 15:15:52 CDT
        </span>
      </div>



<pre class="bz_comment_text" >Macro, link to an image used when the bug appears and results from correct and incorrect measurements added.
Also when the macro was run on another computer (32-bit WinXP) from the original (64-bit Mac) where the bug was first encountered the same faulty results appeared. Recreating the workflow manually had correct results. Running the macro only to the the point before &quot;Image Math&quot; and then running that process manually still resulted in the bug showing up.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Schindelin</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2012-06-07 10:38:56 CDT
        </span>
      </div>



<pre class="bz_comment_text" >First of all, please make things easier in the future. I had to fiddle for half an hour until I had all the files and all the correct settings. No metadata, Split Channels, no Autoscale, and Legacy ImageJ Stack were the settings for Bio-Formats that I used.

Your issue appears to be fixable by changing the order of the operands of the AND operation.

Since you report a breakage for 1.46j on MacOSX but none on 1.46j on Windows, I suspect that the test was performed with differing operand orders.

But I suspect a much bigger problem there: since the second channel is converted to a mask, which is no longer 16-bit but instead 8-bit, the AND operation is likely not doing what you think it should do. (And that is the reason why the otherwise commutative AND operation is not commutative in your case.)

Much more robust than relying on ImageJ 1.x trying to guess what it should do about the type mismatch would be to convert the mask to 16-bit, dividing it by 255 and the multiplying the first channel with it. That way you do not leave room for ImageJ to guess what you want.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        



</div>

</body>
</html>
